From 636984db269b3fa4e2c6c7423149248980b78521 Mon Sep 17 00:00:00 2001
From: Richard Hughes <richard@hughsie.com>
Date: Thu, 13 Feb 2020 16:26:24 +0000
Subject: [PATCH] uefi: Find the correct lds and crt name when specifying
 -Defi_ldsdir

---
 plugins/uefi/efi/meson.build | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/plugins/uefi/efi/meson.build b/plugins/uefi/efi/meson.build
index e49a4cb2..c6be302a 100644
--- a/plugins/uefi/efi/meson.build
+++ b/plugins/uefi/efi/meson.build
@@ -48,6 +48,16 @@ if efi_ldsdir == ''
       error('Cannot find @0@'.format(arch_lds))
     endif
   endif
+else
+  cmd = run_command('test', '-f', join_paths(efi_ldsdir, arch_lds))
+  if cmd.returncode() != 0
+    arch_lds = 'elf_@0@_efi.lds'.format(gnu_efi_path_arch)
+    arch_crt = 'crt0-efi-@0@.o'.format(gnu_efi_path_arch)
+    cmd = run_command('test', '-f', join_paths(efi_ldsdir, arch_lds))
+  endif
+  if cmd.returncode() != 0
+    error('Cannot find @0@'.format(arch_lds))
+  endif
 endif
 
 message('efi-libdir: "@0@"'.format(efi_libdir))
-- 
2.24.1

